(function(){this.ColorCanvas=function(a){return new ColorCanvas.Picker(a)}}).call(this),function(){var a,b,c,d,e,f=[].slice,g=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){return function(){return a.apply(b,arguments)}},i={}.hasOwnProperty,j=function(a,b){function d(){this.constructor=a}for(var c in b)i.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};b={bind:function(a,b){var c,d,e,f,g;d=a.split(" "),c=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={});for(f=0,g=d.length;f<g;f++)e=d[f],c[e]||(c[e]=[]),c[e].push(b);return this},one:function(a,b){return this.bind(a,function(){return this.unbind(a,arguments.callee),b.apply(this,arguments)})},trigger:function(){var a,b,c,d,e,g,h;a=1<=arguments.length?f.call(arguments,0):[],c=a.shift(),d=this.hasOwnProperty("_callbacks")&&((h=this._callbacks)!=null?h[c]:void 0);if(!d)return;for(e=0,g=d.length;e<g;e++){b=d[e];if(b.apply(this,a)===!1)break}return!0},unbind:function(a,b){var c,d,e,f,g,h;if(!a)return this._callbacks={},this;e=(h=this._callbacks)!=null?h[a]:void 0;if(!e)return this;if(!b)return delete this._callbacks[a],this;for(d=f=0,g=e.length;f<g;d=++f){c=e[d];if(c!==b)continue;e=e.slice(),e.splice(d,1),this._callbacks[a]=e;break}return this}},e=["included","extended"],c=function(){function a(){typeof this.init=="function"&&this.init.apply(this,arguments)}return a.name="Module",a.include=function(a){var b,c,d;if(!a)throw"include(obj) requires obj";for(b in a)c=a[b],g.call(e,b)<0&&(this.prototype[b]=c);return(d=a.included)!=null&&d.apply(this),this},a.extend=function(a){var b,c,d;if(!a)throw"extend(obj) requires obj";for(b in a)c=a[b],g.call(e,b)<0&&(this[b]=c);return(d=a.extended)!=null&&d.apply(this),this},a.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}},a.prototype.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}},a}(),a=function(a){function c(a){this.release=h(this.release,this);var b,d,e;this.options=a,e=this.options;for(b in e)d=e[b],this[b]=d;this.el||(this.el=document.createElement(this.tag)),this.el=$(this.el),this.className&&this.el.addClass(this.className),this.attributes&&this.el.attr(this.attributes),this.events||(this.events=this.constructor.events),this.elements||(this.elements=this.constructor.elements),this.events&&this.delegateEvents(this.events),this.elements&&this.refreshElements(),c.__super__.constructor.apply(this,arguments)}return j(c,a),c.name="Controller",c.prototype.eventSplitter=/^(\S+)\s*(.*)$/,c.prototype.tag="div",c.include(b),c.prototype.release=function(){return this.el.remove(),this.unbind()},c.prototype.$=function(a){return $(a,this.el)},c.prototype.delegateEvents=function(a){var b,c,d,e,f,g,h=this;g=[];for(c in a)e=a[c],typeof e!="function"&&(e=function(a){return function(){return h[a].apply(h,arguments),!0}}(e)),d=c.match(this.eventSplitter),b=d[1],f=d[2],f===""?g.push(this.el.bind(b,e)):g.push(this.el.delegate(f,b,e));return g},c.prototype.refreshElements=function(){var a,b,c,d;c=this.elements,d=[];for(a in c)b=c[a],d.push(this[b]=this.$(a));return d},c.prototype.html=function(a){return this.el.html(a.el||a),this.refreshElements(),this.el},c.prototype.append=function(){var a,b,c;return b=1<=arguments.length?f.call(arguments,0):[],b=function(){var c,d,e;e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(a.el||a);return e}(),(c=this.el).append.apply(c,b),this.refreshElements(),this.el},c}(c),d=this.ColorCanvas.Spine={},d.Controller=a}.call(this),function(){this.ColorCanvas.Color=function(){function a(a,b,c,d){d==null&&(d=1),a!=null&&(this.r=parseInt(a,10)),b!=null&&(this.g=parseInt(b,10)),c!=null&&(this.b=parseInt(c,10)),this.a=parseFloat(d)}return a.name="Color",a.regex=/(?:#([0-9a-f]{3,6})|rgba?\(([^)]+)\))/i,a.fromHex=function(a){var b,c,d;return a[0]==="#"&&(a=a.substring(1,7)),a.length===3&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)),d=parseInt(a.substring(0,2),16),c=parseInt(a.substring(2,4),16),b=parseInt(a.substring(4,6),16),new this(d,c,b)},a.fromString=function(a){var b,c,d,e,f,g,h,i;f=a.match(this.regex);if(!f)return null;if(e=f[1])return this.fromHex(e);if(h=f[2])return i=h.split(/\s*,\s*/),g=i[0],d=i[1],c=i[2],b=i[3],new this(g,d,c,b)},a.White=function(b){return new a(255,255,255,b)},a.Black=function(b){return new a(0,0,0,b)},a.Transparent=function(){return new a},a.prototype.toHex=function(){var a;return this.r==null||this.g==null||this.b==null?"transparent":(a=(this.b|this.g<<8|this.r<<16).toString(16),a="#"+"000000".substr(0,6-a.length)+a,a.toUpperCase())},a.prototype.isTransparent=function(){return!this.a},a.prototype.set=function(a){var b,c;for(b in a)c=a[b],this[b]=c;return this},a.prototype.rgb=function(){var a;return a={r:this.r,g:this.g,b:this.b}},a.prototype.rgba=function(){var a;return a={r:this.r,g:this.g,b:this.b,a:this.a}},a.prototype.clone=function(){return new this.constructor(this.r,this.g,this.b,this.a)},a.prototype.toString=function(){return this.r!=null&&this.g!=null&&this.b!=null?this.a!=null?"rgba("+this.r+", "+this.g+", "+this.b+", "+this.a+")":"rgb("+this.r+", "+this.g+", "+this.b+")":"transparent"},a}()}.call(this),function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,e=function(a,b){function e(){this.constructor=a}for(var c in b)d.call(b,c)&&(a[c]=b[c]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};a=this.ColorCanvas.Color,b=this.ColorCanvas.Spine,this.ColorCanvas.Canvas=function(b){function d(){this.drop=c(this.drop,this),this.over=c(this.over,this),d.__super__.constructor.apply(this,arguments),this.el.attr({width:this.width,height:this.height}),this.ctx=this.el[0].getContext("2d")}return e(d,b),d.name="Canvas",d.prototype.tag="canvas",d.prototype.width=100,d.prototype.height=100,d.prototype.events={mousedown:"drag"},d.prototype.val=function(b,c){var d;return d=this.ctx.getImageData(b,c,1,1).data,new a(d[0],d[1],d[2])},d.prototype.drag=function(a){return this.el.mousemove(this.over),$(document).mouseup(this.drop),this.over(a)},d.prototype.over=function(a){var b,c,d;return a.preventDefault(),b=this.el.offset(),c=a.pageX-b.left,d=a.pageY-b.top,this.trigger("change",this.val(c,d))},d.prototype.drop=function(){return this.el.unbind("mousemove",this.over),$(document).unbind("mouseup",this.drop)},d.prototype.release=function(){return d.__super__.release.apply(this,arguments),this.drop()},d}(b.Controller)}.call(this),function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};b=this.ColorCanvas.Color,a=this.ColorCanvas.Canvas,this.ColorCanvas.Alpha=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.color||(this.color=new b(0,0,0)),this.setColor(this.color)}return d(c,a),c.name="Alpha",c.prototype.className="alpha",c.prototype.width=25,c.prototype.height=250,c.prototype.render=function(){var a;return this.ctx.clearRect(0,0,this.width,this.height),a=this.ctx.createLinearGradient(0,0,0,this.height),a.addColorStop(0,this.color.clone().set({a:0}).toString()),a.addColorStop(.9,this.color.clone().set({a:1}).toString()),this.ctx.fillStyle=a,this.ctx.fillRect(0,0,this.width,this.height)},c.prototype.setColor=function(a){return this.color=a,this.render()},c.prototype.val=function(a,b){var c;return c=this.ctx.getImageData(a,b,1,1).data,this.color.set({a:Math.round(c[3]/255*100)/100})},c}(a)}.call(this),function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};a=this.ColorCanvas.Color,b=this.ColorCanvas.Spine,this.ColorCanvas.Display=function(b){function c(){c.__super__.constructor.apply(this,arguments),this.color||(this.color=new a(0,0,0)),this.render(),this.setColor(this.color)}return d(c,b),c.name="Display",c.prototype.tag="article",c.prototype.elements={"input[name=hex]":"$hex","input[name=r]":"$r","input[name=g]":"$g","input[name=b]":"$b","input[name=a]":"$a",".preview .inner":"$preview",".preview .original":"$original"},c.prototype.events={"change input:not([name=hex])":"change","change input[name=hex]":"changeHex"},c.prototype.render=function(){this.html(JST["picker/views/display"](this));if(this.original)return this.$original.css({background:this.original.toString()})},c.prototype.setColor=function(a){return this.color=a,this.$r.val(this.color.r),this.$g.val(this.color.g),this.$b.val(this.color.b),this.$a.val(Math.round(this.color.a*100)),this.$hex.val(this.color.toHex()),this.$preview.css({background:this.color.toString()})},c.prototype.change=function(b){var c;return b.preventDefault(),c=new a(this.$r.val(),this.$g.val(),this.$b.val(),parseFloat(this.$a.val())/100),this.trigger("change",c)},c.prototype.changeHex=function(b){var c;return b.preventDefault(),c=a.fromHex(this.$hex.val()),this.trigger("change",c)},c}(b.Controller)}.call(this),function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},e=[].slice;b=this.ColorCanvas.Color,a=this.ColorCanvas.Canvas,this.ColorCanvas.Gradient=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.color||(this.color=new b.Black),this.setColor(this.color)}return d(c,a),c.name="Gradient",c.prototype.className="gradient",c.prototype.width=250,c.prototype.height=250,c.prototype.setColor=function(a){return this.color=a,this.render()},c.prototype.colorWithAlpha=function(a){var b;return b=this.color.clone(),b.a=a,b},c.prototype.renderGradient=function(){var a,b,c,d,f,g,h,i,j;f=arguments[0],b=2<=arguments.length?e.call(arguments,1):[],c=(i=this.ctx).createLinearGradient.apply(i,[0,0].concat(e.call(f))),c.addColorStop(0,(j=b.shift())!=null?j.toString():void 0);for(d=g=0,h=b.length;g<h;d=++g)a=b[d],c.addColorStop(d+1/b.length,a.toString());return this.ctx.fillStyle=c,this.ctx.fillRect(0,0,this.width,this.height)},c.prototype.render=function(){var a;return this.ctx.clearRect(0,0,this.width,this.height),this.renderGradient([this.width,0],new b(255,255,255),new b(255,255,255)),this.renderGradient([this.width,0],this.colorWithAlpha(0),this.colorWithAlpha(1)),a=this.ctx.createLinearGradient(0,0,-6,this.height),a.addColorStop(0,(new b(0,0,0,0)).toString()),a.addColorStop(1,(new b(0,0,0,1)).toString()),this.ctx.fillStyle=a,this.ctx.fillRect(0,0,this.width,this.height)},c}(this.ColorCanvas.Canvas)}.call(this),function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};b=this.ColorCanvas.Color,a=this.ColorCanvas.Canvas,this.ColorCanvas.Spectrum=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.color||(this.color=new b(0,0,0)),this.setColor(this.color)}return d(c,a),c.name="Spectrum",c.prototype.className="spectrum",c.prototype.width=25,c.prototype.height=250,c.prototype.render=function(){var a;return this.ctx.clearRect(0,0,this.width,this.height),a=this.ctx.createLinearGradient(0,0,0,this.height),a.addColorStop(0,"rgb(255,   0,   0)"),a.addColorStop(.16,"rgb(255,   0, 255)"),a.addColorStop(.33,"rgb(0,     0, 255)"),a.addColorStop(.5,"rgb(0,   255, 255)"),a.addColorStop(.67,"rgb(0,   255,   0)"),a.addColorStop(.83,"rgb(255, 255,   0)"),a.addColorStop(1,"rgb(255,   0,   0)"),this.ctx.fillStyle=a,this.ctx.fillRect(0,0,this.width,this.height)},c.prototype.setColor=function(a){return this.color=a,this.render()},c}(a)}.call(this),function(){this.JST||(this.JST={}),this.JST["picker/views/display"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<div class="controls">\n  <form>\n    <label>\n      <span>R</span>\n      <input type="number" min="0" max="255" name="r" required autofocus>\n    </label>\n\n    <label>\n      <span>G</span>\n      <input type="number" min="0" max="255" name="g" required>\n    </label>\n\n    <label>\n      <span>B</span>\n      <input type="number" min="0" max="255" name="b" required>\n    </label>\n\n    <label>\n      <span>A</span>\n      <input type="number" min="0" max="100" step="1" name="a">%\n    </label>\n\n    <label>\n      <span>Hex</span>\n      <input type="text" name="hex">\n    </label>\n\n    <div class="preview">\n      <div class="inner">\n        &nbsp;\n      </div>\n      <div class="original">\n        &nbsp;\n      </div>\n    </div>\n  </form>\n</div>\n')}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")}}.call(this),function(){var a,b,c,d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};f=this.ColorCanvas.Spine,b=this.ColorCanvas.Color,d=this.ColorCanvas.Gradient,e=this.ColorCanvas.Spectrum,a=this.ColorCanvas.Alpha,c=this.ColorCanvas.Display,this.ColorCanvas.Picker=function(f){function g(){g.__super__.constructor.apply(this,arguments),this.color||(this.color=new b(255,0,0)),this.color instanceof b||(this.color=b.fromString(this.color)),this.original=this.color.clone(),this.render()}return h(g,f),g.name="Picker",g.prototype.className="colorPicker",g.prototype.width=425,g.prototype.events={"click .save":"save","click .cancel":"cancel","form submit":"save"},g.prototype.render=function(){var b=this;return this.el.empty(),this.gradient=new d({color:this.color}),this.spectrum=new e({color:this.color}),this.alpha=new a({color:this.color}),this.display=new c({color:this.color,original:this.original}),this.gradient.bind("change",function(a){return b.color.set(a.rgb()),b.display.setColor(b.color),b.alpha.setColor(b.color),b.change()}),this.spectrum.bind("change",function(a){return b.color.set(a.rgb()),b.gradient.setColor(b.color),b.display.setColor(b.color),b.alpha.setColor(b.color),b.change()}),this.alpha.bind("change",function(a){return b.color.set({a:a.a}),b.display.setColor(b.color),b.change()}),this.display.bind("change",function(a){return b.setColor(a)}),this.append(this.gradient,this.spectrum,this.alpha,this.display)},g.prototype.setColor=function(a){return this.color=a,this.display.setColor(this.color),this.gradient.setColor(this.color),this.spectrum.setColor(this.color),this.alpha.setColor(this.color),this.change()},g.prototype.change=function(a){return a==null&&(a=this.color),this.trigger("change",a)},g.prototype.save=function(a){return a.preventDefault(),this.close(),this.trigger("save",this.color)},g.prototype.cancel=function(a){return a.preventDefault(),this.close(),this.trigger("cancel"),this.trigger("change",this.original)},g.prototype.release=function(){return g.__super__.release.apply(this,arguments),this.gradient.release(),this.spectrum.release(),this.display.release()},g}(f.Controller)}.call(this);